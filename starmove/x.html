<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å±±ç¾Šã®å‰ç«¯å°çª</title>
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        body {
            width: 100%;
            height: 100vh;
            /* èƒŒæ™¯æ¸å˜ */
            background-image: linear-gradient(-225deg, #231557 0%,
                    #43107a 29%, #FF1361 100%);
        }

        canvas {
            position: fixed;
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>

    <canvas></canvas>

</body>
<script>

    // å®šä¹‰æ˜Ÿæ˜Ÿçš„é¢œè‰²
    const STAR_COLOR = '#fff';
    // å®šä¹‰æ˜Ÿæ˜Ÿçš„å¤§å°
    const STAR_SIZE = 3;
    // å®šä¹‰æ˜Ÿæ˜Ÿçš„æœ€å°ç¼©æ”¾æ¯”ä¾‹
    const STAR_MIN_SCALE = 0.2;
    // å®šä¹‰æº¢å‡ºé˜ˆå€¼
    const OVERFLOW_THRESHOLD = 50;
    // å®šä¹‰æ˜Ÿæ˜Ÿçš„æ•°é‡
    const STAR_COUNT = (window.innerWidth + window.innerHeight) / 8;
    // è·å–canvaså…ƒç´ 
    const canvas = document.querySelector('canvas');
    // è·å–canvasçš„ç»˜å›¾ä¸Šä¸‹æ–‡
    const context = canvas.getContext('2d');
    // å®šä¹‰ç¼©æ”¾æ¯”ä¾‹
    let scale = 1; // device pixel ratio
    // å®šä¹‰å®½åº¦å’Œé«˜åº¦
    let width;
    let height;
    // å®šä¹‰æ˜Ÿæ˜Ÿæ•°ç»„
    let stars = [];
    // å®šä¹‰é¼ æ ‡æŒ‡é’ˆçš„ä½ç½®
    let pointerX;
    let pointerY;
    // ğŸŒŸ æ ¸å¿ƒä¿®æ”¹1ï¼šé™ä½åŸºç¡€æ—‹è½¬é€Ÿåº¦ï¼ˆåŸ0.0009 â†’ 0.0002ï¼‰
    let velocity = { x: 0, y: 0, tx: 0, ty: 0, z: 0.0002 };
    // å®šä¹‰è§¦æ‘¸è¾“å…¥æ ‡å¿—
    let touchInput = false;
    // ç”Ÿæˆæ˜Ÿæ˜Ÿ
    generate();
    // è°ƒæ•´å¤§å°
    resize();
    // è¿è¡ŒåŠ¨ç”»
    step();
    // å½“çª—å£å¤§å°æ”¹å˜æ—¶ï¼Œé‡æ–°è°ƒæ•´å¤§å°
    window.onresize = resize;
    // å½“é¼ æ ‡åœ¨canvasä¸Šç§»åŠ¨æ—¶ï¼Œæ›´æ–°é¼ æ ‡æŒ‡é’ˆä½ç½®
    canvas.onmousemove = onMouseMove;
    // å½“è§¦æ‘¸å±åœ¨canvasä¸Šç§»åŠ¨æ—¶ï¼Œæ›´æ–°é¼ æ ‡æŒ‡é’ˆä½ç½®
    canvas.ontouchmove = onTouchMove;
    // å½“è§¦æ‘¸å±ç¦»å¼€canvasæ—¶ï¼Œæ›´æ–°é¼ æ ‡æŒ‡é’ˆä½ç½®
    canvas.ontouchend = onMouseLeave;
    // å½“é¼ æ ‡ç¦»å¼€æ–‡æ¡£æ—¶ï¼Œæ›´æ–°é¼ æ ‡æŒ‡é’ˆä½ç½®
    document.onmouseleave = onMouseLeave;
    // ç”Ÿæˆæ˜Ÿæ˜Ÿ
    function generate() {
        for (let i = 0; i < STAR_COUNT; i++) {
            stars.push({
                x: 0,
                y: 0,
                z: STAR_MIN_SCALE + Math.random() * (1 - STAR_MIN_SCALE),
            });
        }
    }
    // å°†æ˜Ÿæ˜Ÿæ”¾ç½®åˆ°éšæœºä½ç½®
    function placeStar(star) {
        star.x = Math.random() * width;
        star.y = Math.random() * height;
    }
    // å›æ”¶æ˜Ÿæ˜Ÿå¹¶é‡æ–°æ”¾ç½®åˆ°æ–°çš„ä½ç½®
    function recycleStar(star) {
        // åˆå§‹åŒ–æ–¹å‘ä¸º 'z'
        let direction = 'z';
        // è·å–é€Ÿåº¦çš„ç»å¯¹å€¼
        let vx = Math.abs(velocity.x);
        let vy = Math.abs(velocity.y);
        // å¦‚æœé€Ÿåº¦çš„ç»å¯¹å€¼å¤§äº1ï¼Œåˆ™æ ¹æ®é€Ÿåº¦çš„å¤§å°éšæœºç¡®å®šæ–¹å‘
        if (vx > 1 || vy > 1) {
            let axis;
            // å¦‚æœæ°´å¹³é€Ÿåº¦å¤§äºå‚ç›´é€Ÿåº¦ï¼Œåˆ™æ ¹æ®æ°´å¹³é€Ÿåº¦çš„æ¯”ä¾‹éšæœºç¡®å®šæ°´å¹³æˆ–å‚ç›´æ–¹å‘
            if (vx > vy) {
                axis = Math.random() < vx / (vx + vy) ? 'h' : 'v';
            } else {
                axis = Math.random() < vy / (vx + vy) ? 'v' : 'h';
            }
            // æ ¹æ®æ–¹å‘ç¡®å®šå…·ä½“çš„ç§»åŠ¨æ–¹å‘
            if (axis === 'h') {
                direction = velocity.x > 0 ? 'l' : 'r';
            } else {
                direction = velocity.y > 0 ? 't' : 'b';
            }
        }
        // éšæœºè®¾ç½®æ˜Ÿæ˜Ÿçš„ç¼©æ”¾æ¯”ä¾‹
        star.z = STAR_MIN_SCALE + Math.random() * (1 - STAR_MIN_SCALE);
        // æ ¹æ®æ–¹å‘è®¾ç½®æ˜Ÿæ˜Ÿçš„ä½ç½®
        if (direction === 'z') {
            // å¦‚æœæ–¹å‘ä¸º 'z'ï¼Œåˆ™å°†æ˜Ÿæ˜Ÿæ”¾ç½®åœ¨å±å¹•ä¸­å¿ƒ
            star.z = 0.1;
            star.x = Math.random() * width;
            star.y = Math.random() * height;
        } else if (direction === 'l') {
            // å¦‚æœæ–¹å‘ä¸º 'l'ï¼Œåˆ™å°†æ˜Ÿæ˜Ÿæ”¾ç½®åœ¨å±å¹•å·¦ä¾§
            star.x = -OVERFLOW_THRESHOLD;
            star.y = height * Math.random();
        } else if (direction === 'r') {
            // å¦‚æœæ–¹å‘ä¸º 'r'ï¼Œåˆ™å°†æ˜Ÿæ˜Ÿæ”¾ç½®åœ¨å±å¹•å³ä¾§
            star.x = width + OVERFLOW_THRESHOLD;
            star.y = height * Math.random();
        } else if (direction === 't') {
            // å¦‚æœæ–¹å‘ä¸º 't'ï¼Œåˆ™å°†æ˜Ÿæ˜Ÿæ”¾ç½®åœ¨å±å¹•é¡¶éƒ¨
            star.x = width * Math.random();
            star.y = -OVERFLOW_THRESHOLD;
        } else if (direction === 'b') {
            // å¦‚æœæ–¹å‘ä¸º 'b'ï¼Œåˆ™å°†æ˜Ÿæ˜Ÿæ”¾ç½®åœ¨å±å¹•åº•éƒ¨
            star.x = width * Math.random();
            star.y = height + OVERFLOW_THRESHOLD;
        }
    }
    // è°ƒæ•´å¤§å°
    function resize() {
        // è·å–è®¾å¤‡åƒç´ æ¯”ä¾‹
        scale = window.devicePixelRatio || 1;
        // è®¾ç½®ç”»å¸ƒçš„å®½åº¦å’Œé«˜åº¦
        width = window.innerWidth * scale;
        height = window.innerHeight * scale;
        canvas.width = width;
        canvas.height = height;
        // å°†æ‰€æœ‰æ˜Ÿæ˜Ÿé‡æ–°æ”¾ç½®åˆ°å±å¹•ä¸Š
        stars.forEach(placeStar);
    }
    // åŠ¨ç”»çš„æ¯ä¸€å¸§
    function step() {
        // æ¸…ç©ºç”»å¸ƒ
        context.clearRect(0, 0, width, height);
        // æ›´æ–°æ˜Ÿæ˜Ÿçš„ä½ç½®å’Œé€Ÿåº¦
        update();
        // ç»˜åˆ¶æ˜Ÿæ˜Ÿ
        render();
        // è¯·æ±‚ä¸‹ä¸€å¸§åŠ¨ç”»
        requestAnimationFrame(step);
    }
    // æ›´æ–°æ˜Ÿæ˜Ÿçš„ä½ç½®å’Œé€Ÿåº¦
    function update() {
        // ç¼“åŠ¨é€Ÿåº¦
        velocity.tx *= 0.96;
        velocity.ty *= 0.96;
        // æ›´æ–°é€Ÿåº¦
        velocity.x += (velocity.tx - velocity.x) * 0.8;
        velocity.y += (velocity.ty - velocity.y) * 0.8;
        // éå†æ‰€æœ‰æ˜Ÿæ˜Ÿ
        stars.forEach((star) => {
            // æ ¹æ®é€Ÿåº¦å’Œç¼©æ”¾æ¯”ä¾‹æ›´æ–°æ˜Ÿæ˜Ÿçš„ä½ç½®
            star.x += velocity.x * star.z;
            star.y += velocity.y * star.z;
            // æ ¹æ®é€Ÿåº¦å’Œç¼©æ”¾æ¯”ä¾‹æ›´æ–°æ˜Ÿæ˜Ÿçš„ä½ç½®ï¼ˆä½¿æ˜Ÿæ˜Ÿå›´ç»•å±å¹•ä¸­å¿ƒæ—‹è½¬ï¼‰
            star.x += (star.x - width / 2) * velocity.z * star.z;
            star.y += (star.y - height / 2) * velocity.z * star.z;
            // æ›´æ–°æ˜Ÿæ˜Ÿçš„ç¼©æ”¾æ¯”ä¾‹
            star.z += velocity.z;
            // å¦‚æœæ˜Ÿæ˜Ÿè¶…å‡ºå±å¹•èŒƒå›´ï¼Œåˆ™é‡æ–°æ”¾ç½®åˆ°å±å¹•ä¸Š
            if (
                star.x < -OVERFLOW_THRESHOLD ||
                star.x > width + OVERFLOW_THRESHOLD ||
                star.y < -OVERFLOW_THRESHOLD ||
                star.y > height + OVERFLOW_THRESHOLD
            ) {
                recycleStar(star);
            }
        });
    }
    // ç»˜åˆ¶æ˜Ÿæ˜Ÿ
    function render() {
        // éå†æ‰€æœ‰æ˜Ÿæ˜Ÿ
        stars.forEach((star) => {
            // è®¾ç½®ç»˜åˆ¶æ˜Ÿæ˜Ÿçš„æ ·å¼
            context.beginPath();
            context.lineCap = 'round';
            context.lineWidth = STAR_SIZE * star.z * scale;
            context.globalAlpha = 0.5 + 0.5 * Math.random();
            context.strokeStyle = STAR_COLOR;
            // ç»˜åˆ¶æ˜Ÿæ˜Ÿçš„è·¯å¾„
            context.beginPath();
            context.moveTo(star.x, star.y);
            // è®¡ç®—æ˜Ÿæ˜Ÿçš„å°¾å·´åæ ‡
            let tailX = velocity.x * 2;
            let tailY = velocity.y * 2;
            // å¦‚æœå°¾å·´åæ ‡çš„ç»å¯¹å€¼å°äº0.1ï¼Œåˆ™è®¾ç½®ä¸º0.5
            if (Math.abs(tailX) < 0.1) tailX = 0.5;
            if (Math.abs(tailY) < 0.1) tailY = 0.5;
            // ç»˜åˆ¶æ˜Ÿæ˜Ÿçš„å°¾å·´
            context.lineTo(star.x + tailX, star.y + tailY);
            context.stroke();
        });
    }
    // ç§»åŠ¨é¼ æ ‡æŒ‡é’ˆ
    function movePointer(x, y) {
        // å¦‚æœä¹‹å‰æœ‰è®°å½•é¼ æ ‡æŒ‡é’ˆçš„ä½ç½®ï¼Œåˆ™è®¡ç®—é¼ æ ‡æŒ‡é’ˆçš„ç§»åŠ¨è·ç¦»ï¼Œå¹¶æ›´æ–°é€Ÿåº¦
        if (typeof pointerX === 'number' && typeof pointerY === 'number') {
            let ox = x - pointerX;
            let oy = y - pointerY;
            // ğŸŒŸ æ ¸å¿ƒä¿®æ”¹2ï¼šé™ä½é¼ æ ‡ç§»åŠ¨è½¬åŒ–ä¸ºé€Ÿåº¦çš„æ¯”ä¾‹ï¼ˆåŸ1/8 â†’ 1/20ï¼‰
            velocity.tx = velocity.tx + (ox / 20) * scale * (touchInput ? 1 : -1);
            velocity.ty = velocity.ty + (oy / 20) * scale * (touchInput ? 1 : -1);
        }
        // æ›´æ–°é¼ æ ‡æŒ‡é’ˆçš„ä½ç½®
        pointerX = x;
        pointerY = y;
    }
    // å½“é¼ æ ‡åœ¨canvasä¸Šç§»åŠ¨æ—¶çš„äº‹ä»¶å¤„ç†å‡½æ•°
    function onMouseMove(event) {
        touchInput = false;
        movePointer(event.clientX, event.clientY);
    }
    // å½“è§¦æ‘¸å±åœ¨canvasä¸Šç§»åŠ¨æ—¶çš„äº‹ä»¶å¤„ç†å‡½æ•°
    function onTouchMove(event) {
        touchInput = true;
        movePointer(event.touches[0].clientX, event.touches[0].clientY, true);
        event.preventDefault();
    }
    // å½“é¼ æ ‡ç¦»å¼€canvasæ—¶çš„äº‹ä»¶å¤„ç†å‡½æ•°
    function onMouseLeave() {
        pointerX = null;
        pointerY = null;
    }
</script>

</html>